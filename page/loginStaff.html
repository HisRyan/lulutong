<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ¥è¯¢ç†èµ”ä¿¡æ¯</title>
    <link rel="stylesheet" href="/css/homeCard.css">
    <script src="/js/ajax.js"></script>
    <script src="/js/regular.js"></script>
</head>

<body>
    <div class="wrap">
        <ul class="plan">
            <li>
                <div class="left check">1</div>
                <div class="right">æœåŠ¡å¡ç™»å½•</div>
            </li>
            <li>
                <div class="left">2</div>
                <div class="right">æŸ¥çœ‹æœåŠ¡å¡</div>
            </li>
        </ul>
    </div>
    <div class="main">
        <form action="">
            <div>
                <p class="checkId"></p>
                <input class="cardId" type="text" placeholder="å¡å·">

            </div>

            <div>
                <p class="checkPwd"></p>
                <input class="passWord" type="password" placeholder="å¯†ç /èº«ä»½è¯å·">
                <img class="pwd" src="/image/eyepwd.png" alt="">

            </div>

            <div>
                <p class="checkCode"></p>
                <input class="code" type="text" placeholder="éªŒè¯ç ">
                <img class="imgpwd" src="/php/validatecode.php" alt=""
                    onclick="javascript:this.src ='/php/validatecode.php?tm='+Math.random();">

            </div>

            <input class="next" type="button" name="" id="" value="ä¸‹ä¸€æ­¥">
        </form>
    </div>

    <!-- å½“æŸ¥è¯¢åˆ°å¡å­˜åœ¨ä½†æœªæ¿€æ´»ï¼Œæç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦æ¿€æ´» -->
    <div class="hint">
        <p>æ­¤å¡æœªæ¿€æ´»ï¼Œæ˜¯å¦å‰å¾€æ¿€æ´»</p>
        <input class="go" type="button" value="å‰å¾€" onclick="goadd()">
        <input class="exit" type="button" value="å–æ¶ˆ" onclick="exit()">
    </div>
</body>
<script>
    var nextDOM = document.querySelector('.next');
    var checkPwdDOM = document.querySelector('.checkPwd');
    var checkCodeDOM = document.querySelector('.checkCode');
    var cardIdDOM = document.querySelector('.cardId');
    var passWordDOM = document.querySelector('.passWord');
    var codeDOM = document.querySelector(".code");
    var checkIdDOM = document.querySelector('.checkId');
    var hintDOM = document.querySelector('.hint');
    var rg = new RegQ();
    //åˆ¤æ–­ç™»å½•æ¡†æ˜¯å¦æœ‰æ•°æ®
    var flagId = 0;
    var flagPwd = 0;
    var flagLogo = 0;
    //åˆ¤æ–­å¡å·æ˜¯å¦ç¬¦åˆæ ¼å¼
    cardIdDOM.addEventListener('blur', function () {
        let id = cardIdDOM.value;
        if (rg.txqq(id)) {
            checkIdDOM.innerHTML = `<span class="idTrue">ğŸ˜ƒå¡å·æ ¼å¼æ­£ç¡®</span>`;
            flagId = 1;
        } else if (rg.nonull(id)) {
            checkIdDOM.innerHTML = "";
            flagId = 0;
        } else {
            checkIdDOM.innerHTML = `<span class="idFalse">ğŸ˜¥å¡å·æ ¼å¼é”™è¯¯</span>`;
            flagId = 0;
        }
    })

    // onfocus
    cardIdDOM.addEventListener('focus', function () {
        checkIdDOM.innerHTML = "";
        checkPwdDOM.innerHTML = "";
    })

    passWordDOM.addEventListener('focus', function () {
        checkPwdDOM.innerHTML = "";
    });

    codeDOM.addEventListener('focus', function () {
        checkCodeDOM.innerHTML = "";
        checkPwdDOM.innerHTML = "";
    })



    //ä¸‹ä¸€æ­¥ç‚¹å‡»äº‹ä»¶
    nextDOM.addEventListener('click', function () {
        //è·å–ç”¨æˆ·è¾“å…¥çš„å€¼
        var id = document.querySelector('.cardId').value;
        var pwd = passWordDOM.value;
        var code = codeDOM.value;
        //æ•°æ®å­˜å…¥session
        sessionStorage.setItem('id', id);
        if (flagId == 0) {
            checkIdDOM.innerHTML = `<span class="idFalse">ğŸ˜ƒè¯·è¾“å…¥æ­£ç¡®çš„å¡å·</span>`;
            return;
        }
        //åˆ¤æ–­æ˜¯å¦è¾“å…¥äº†å¯†ç 
        if (rg.nonull(pwd)) {
            checkPwdDOM.innerHTML = "è¯·è¾“å…¥å¯†ç ";
            return;
        }
        //åˆ¤æ–­æ˜¯å¦è¾“å…¥äº†éªŒè¯ç 
        if (rg.nonull(code)) {
            checkCodeDOM.innerHTML = "è¯·è¾“å…¥éªŒè¯ç ";
            return;
        }
        //è°ƒç”¨ajaxå‡½æ•°
        else {
            myajax({
                "url": "../php/login.php",
                "arg": {
                    "id": id,
                    "pwd": pwd,
                    "act": "card",
                    "code": code
                },
                "success": function (re) {
                    if (re.code == 2) {
                        window.location.href = `staff.html`;
                    } else {
                        choose(re.code);
                        console.log(re);
                    }
                }
            });
        }
    });

    function choose(index) {
        switch (index) {
            case 0:
                hintDOM.style.display = "block";
                break;
            case 1:
                checkPwdDOM.innerHTML = "å¡å·²æ¿€æ´»ï¼Œæœªåˆ°ç”Ÿæ•ˆæœŸ";
                break;
            case 3:
                checkPwdDOM.innerHTML = "å¡å·²è¿‡æœŸ";
                break;
            case 4:
                checkPwdDOM.innerHTML = "è´¦å·æˆ–è€…å¯†ç é”™è¯¯";
                break;
            case 5:
                checkPwdDOM.innerHTML = "éªŒè¯ç é”™è¯¯";
                break;
            default:
                break;

        }
    }

    function goadd() {
        window.location.href = `activeCard.html`;
    }

    function exit() {
        hintDOM.style.display = "none";
    }
</script>

</html>